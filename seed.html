<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="icon" href="favicon.ico">
<link rel="apple-touch-icon" href="favicon.png">
<title>Conbi Fan - Seed Archive</title>

<style>
body {
  margin: 0;
  font-family: system-ui, sans-serif;
  background: #0f1220;
  color: #eaeaf0;
}
header {
  padding: 40px 24px;
  text-align: center;
  background: linear-gradient(135deg, #22c55e, #16a34a);
}
main {
  max-width: 900px;
  margin: auto;
  padding: 32px 24px;
}
h2 {
  border-left: 6px solid #22c55e;
  padding-left: 12px;
}
input, select {
  width: 100%;
  padding: 12px;
  border-radius: 12px;
  border: none;
  background: #1e293b;
  color: #eaeaf0;
  margin: 12px 0 20px;
}
.tags button {
  margin: 6px 6px 0 0;
  padding: 6px 14px;
  border-radius: 999px;
  border: none;
  background: #0b1220;
  color: #eaeaf0;
  cursor: pointer;
}
.tags button.active {
  background: #22c55e;
  color: #052e16;
  font-weight: bold;
}
.seed-card {
  background: #1b1f3a;
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.25);
}
.seed {
  font-size: 1.3rem;
  font-weight: bold;
  color: #86efac;
}
.copy, .copy-link, .edition-btn {
  margin-top: 10px;
  margin-right: 10px;
  padding: 8px 16px;
  border-radius: 8px;
  border: none;
  background: #3b82f6;
  color: #fff;
  cursor: pointer;
}
.copy.done, .copy-link.done {
  background: #22c55e;
}
.toast {
  position: fixed;
  bottom: 24px;
  left: 50%;
  transform: translateX(-50%);
  background: #1e293b;
  padding: 12px 20px;
  border-radius: 12px;
  opacity: 0;
  transition: .3s;
}
.toast.show {
  opacity: 1;
}
footer {
  text-align: center;
  padding: 24px;
  background: #0b0e1a;
  opacity: .7;
}
a { color: #93c5fd; text-decoration: none; }
.edition-btn.active { background: #22c55e; color:#052e16; font-weight:bold; }
</style>
</head>

<body>

<header>
  <h1>Seed Archive</h1>
  <p>Minecraft シード値保管庫</p>
</header>

<main>

<h2>検索</h2>
<input id="search" placeholder="シード値・特徴・バージョンで検索">

<h2>タグ</h2>
<div class="tags" id="tags"></div>

<h2>エディション</h2>
<div id="editionBtns">
  <button class="edition-btn active" data-edition="java">Java</button>
  <button class="edition-btn" data-edition="bedrock">Bedrock</button>
</div>

<h2>並び替え</h2>
<select id="sort">
  <option value="new">新着</option>
  <option value="stable">地形安定</option>
</select>

<div id="list"></div>

<p><a href="index.html">← ホームへ戻る</a></p>
</main>

<footer>© 2025 Conbi Fan</footer>
<div class="toast" id="toast"></div>

<script>
const TAG_LABELS = {
  village: "村",
  zombie_village: "ゾンビ村",
  igloo: "イグルー",
  mineshaft: "廃坑",
  nether: "ネザー",
  terrain: "神地形",
  ancient_city: "古代都市",
  trial_chamber: "トライアルチャンバー",
  shipwreck: "沈没船"
};

let seeds = [];
let currentTag = "all";
let currentEdition = "java";

fetch("./seeds.json")
  .then(r => r.json())
  .then(data => {
    seeds = data;
    createTagButtons();
    setupEditionButtons();
    sortSeeds("new");
    checkSharedSeed();
  });

document.getElementById("search").addEventListener("input", renderFiltered);
document.getElementById("sort").addEventListener("change", e => sortSeeds(e.target.value));

function createTagButtons() {
  const tagSet = new Set();
  seeds.forEach(s => s.tags.forEach(t => tagSet.add(t)));
  const tagsDiv = document.getElementById("tags");
  tagsDiv.innerHTML = "";

  const allBtn = document.createElement("button");
  allBtn.textContent = "すべて";
  allBtn.classList.add("active");
  allBtn.onclick = () => selectTag("all", allBtn);
  tagsDiv.appendChild(allBtn);

  tagSet.forEach(t => {
    const b = document.createElement("button");
    b.textContent = TAG_LABELS[t] || t;
    b.onclick = () => selectTag(t, b);
    tagsDiv.appendChild(b);
  });
}

function selectTag(tag, btn) {
  document.querySelectorAll(".tags button").forEach(b => b.classList.remove("active"));
  btn.classList.add("active");
  currentTag = tag;
  renderFiltered();
}

function setupEditionButtons() {
  document.querySelectorAll(".edition-btn").forEach(btn => {
    btn.onclick = () => {
      document.querySelectorAll(".edition-btn").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      currentEdition = btn.dataset.edition;
      renderFiltered();
    };
  });
}

function sortSeeds(type) {
  if (type === "stable") {
    seeds.sort((a,b) => (b.stable||0) - (a.stable||0));
  } else {
    seeds.sort((a,b) => b.id - a.id);
  }
  renderFiltered();
}

function renderFiltered() {
  const word = document.getElementById("search").value.toLowerCase();
  const filtered = seeds.filter(s =>
    s.edition === currentEdition &&
    (currentTag === "all" || s.tags.includes(currentTag)) &&
    (s.seed.includes(word) || s.description.toLowerCase().includes(word) || s.version.toLowerCase().includes(word))
  );
  render(filtered);
}

function render(list) {
  const el = document.getElementById("list");
  el.innerHTML = "";
  list.forEach(s => el.appendChild(makeCard(s)));
}

function makeCard(s) {
  const tagText = s.tags.map(t => TAG_LABELS[t] || t).join(" / ");
  const d = document.createElement("div");
  d.className = "seed-card";
  d.innerHTML = `
    <div class="seed">${s.seed}</div>
    <p>${s.description}</p>
    <p>タグ：${tagText}</p>
    <p>対応バージョン：${s.version}</p>
    <button class="copy" onclick="copySeed('${s.seed}', this)">シード値をコピー</button>
    <button class="copy-link" onclick="copyLink('${s.seed}', this)">リンクをコピー</button>
  `;
  return d;
}

function copySeed(seed, btn) {
  navigator.clipboard.writeText(seed);
  resetCopyButtons(".copy");
  btn.textContent = "✓ コピー済み";
  btn.classList.add("done");
  setTimeout(() => { btn.textContent = "シード値をコピー"; btn.classList.remove("done"); }, 2000);
  showToast("シード値をコピーしました。");
}

function copyLink(seed, btn) {
  const url = `${location.origin}${location.pathname}?seed=${seed}${currentEdition ? `&edition=${currentEdition}` : ""}`;
  navigator.clipboard.writeText(url);
  resetCopyButtons(".copy-link");
  btn.textContent = "✓ コピー済み";
  btn.classList.add("done");
  setTimeout(() => { btn.textContent = "リンクをコピー"; btn.classList.remove("done"); }, 2000);
  showToast("リンクをコピーしました。");
}

function resetCopyButtons(selector){
  document.querySelectorAll(selector).forEach(b => {
    b.textContent = b.classList.contains("copy") ? "シード値をコピー" : "リンクをコピー";
    b.classList.remove("done");
  });
}

function showToast(text) {
  const t = document.getElementById("toast");
  t.textContent = text;
  t.classList.add("show");
  setTimeout(() => t.classList.remove("show"), 1800);
}

function checkSharedSeed() {
  const p = new URLSearchParams(location.search);
  const seed = p.get("seed");
  const edition = p.get("edition");
  if (edition) {
    currentEdition = edition;
    document.querySelectorAll(".edition-btn").forEach(b => b.classList.remove("active"));
    document.querySelector(`.edition-btn[data-edition="${edition}"]`)?.classList.add("active");
  }
  if (!seed) return;
  document.getElementById("search").value = seed;
  renderFiltered();
}
</script>

</body>
</html>
